<div class="featured-header">
  <h2 class="featured-title">RECENT PRODUCTS</h2>
</div>
<div class="search-section">
  <div class="search-wrapper">
    <label class="search-label">ស្វែងរក</label>
    <i class="fa-solid fa-magnifying-glass search-icon"></i>
    <input
      type="text"
      placeholder="Search by name..."
      (input)="updateSearch($event)"
      [value]="searchTerm()"
      class="search-input"
    />
  </div>
</div>
<section class="product-grid">
  @for (item of filteredProducts().slice(0, 8); track item.id) {
    <div class="product-card" (click)="openDetails(item)">
      <div class="product-badge">{{ item.category }}</div>

      <div class="image-container">
        <img [src]="item.image[0]" [alt]="item.name" />
      </div>

      <div class="product-info">
        <h3>{{ item.name }}</h3>
        <div class="divider"></div>
        <p class="specs-label">Technical Specifications:</p>
        <p class="specs-text">{{ item.specs }}</p>
      </div>
    </div>
  }
</section>
<div class="featured-header">
  <h2 class="featured-title">LATEST PRODUCTS</h2>
</div>
<section class="blog-section">
  <div class="blog-grid">
    @for (post of filteredProducts().slice(-6); track post.id) {
      <div class="blog-card" (click)="openDetails(post)" style="cursor: pointer">
        <img [src]="post.image[0]" />
        <div class="blog-content">
          <h4>{{ post.name }}</h4>
          <div class="divider"></div>
          <p [class.show-all]="expandedCards[post.id]">
            {{ post.specs }}
          </p>
          <!-- <a href="javascript:void(0)" class="read-more" (click)="toggleReadMore(post.id)">
            {{ expandedCards[post.id] ? 'Show Less' : 'Read More' }}
            <i
              class="fa-solid"
              [ngClass]="expandedCards[post.id] ? 'fa-angles-up' : 'fa-arrow-right'"
            ></i>
          </a> -->
        </div>
      </div>
    }
  </div>
</section>

<div class="featured-header">
  <h2 class="featured-title">FEATURED PRODUCTS</h2>
</div>
<section class="product-grid">
  @for (item of filteredProducts().slice(8, -6); track item.id) {
    <div class="product-card" (click)="openDetails(item)">
      <div class="product-badge">{{ item.category }}</div>
      <div class="image-container">
        <img [src]="item.image[0]" [alt]="item.name" />
      </div>
      <div class="product-info">
        <h3>{{ item.name }}</h3>
        <div class="divider"></div>
        <p class="specs-label">Technical Specifications:</p>
        <p class="specs-text">{{ item.specs }}</p>
      </div>
    </div>
  }
</section>
<button class="back-to-top" [class.show]="isShow" (click)="scrollToTop()">
  <i class="fa-solid fa-angles-up"></i>
</button>
@if (statusMessage) {
  <div class="status-toast" [ngClass]="statusType">
    <i
      [class]="
        statusType === 'success' ? 'fa-solid fa-circle-check' : 'fa-solid fa-triangle-exclamation'
      "
    ></i>
    <span>{{ statusMessage }}</span>
  </div>
}
@if (selectedProduct(); as product) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <button class="modal-close" (click)="closeModal()">&times;</button>

      <div class="modal-content">
        <div class="modal-left">
          <!-- Big Image -->
          <img
            [src]="selectedImg || product.image[0]"
            alt="{{ product.name }}"
            class="modal-main-img"
          />

          <!-- Thumbnail Images -->
          <div class="modal-img-wrapper">
            <img
              *ngFor="let imgUrl of product.image"
              [src]="imgUrl"
              [alt]="product.name"
              class="modal-img"
              (click)="selectImage(imgUrl)"
            />
          </div>
        </div>

        <div class="modal-right">
          <span class="modal-category">{{ product.category }}</span>
          <h2 class="modal-title">{{ product.name }}</h2>
          <div class="modal-divider"></div>

          <div class="modal-section">
            <h4>Technical Details</h4>
            <p>{{ product.specs }}</p>
          </div>

          <div class="modal-section">
            <h4>Description</h4>
            <p>
              {{ product.description }}
            </p>
          </div>

          <div class="modal-section customer-form">
            <h4 class="form-title">
              <i class="fa-solid fa-address-card"></i> ព័ត៌មានទំនាក់ទំនងផ្នែកលក់
            </h4>

            <div class="input-group">
              <input
                type="text"
                [(ngModel)]="customerName"
                class="form-input"
                [class.input-error]="formSubmitted && !customerName.trim()"
                placeholder="ឈ្មោះរបស់អ្នក..."
              />
            </div>
            @if (formSubmitted && !customerName.trim()) {
              <span class="error-text">សូមបញ្ចូលឈ្មោះរបស់អ្នក!</span>
            }

            <div class="input-group">
              
              <input
                type="text"
                [(ngModel)]="customerPhone"
                class="form-input"
                [class.input-error]="formSubmitted && !customerPhone.trim()"
                placeholder="លេខទូរស័ព្ទ..."
              />
            </div>
            @if (formSubmitted && !customerPhone.trim()) {
              <span class="error-text">សូមបញ្ចូលលេខទូរស័ព្ទ!</span>
            }

            <div class="input-group">
              
              <textarea
                [(ngModel)]="customerNote"
                class="form-input form-textarea"
                placeholder="សារបន្ថែម (Optional)..."
              ></textarea>
            </div>
          </div>

          <button
            class="inquiry-btn"
            (click)="sendToTelegram(selectedProduct())"
            [disabled]="isSending"
          >
            @if (isSending) {
              <i class="fa-solid fa-circle-notch fa-spin"></i> កំពុងផ្ញើ...
            } @else {
              <i class="fa-solid fa-paper-plane"></i> ផ្ញើជូនផ្នែកលក់
            }
          </button>
        </div>
      </div>
    </div>
  </div>
}

<app-footer></app-footer>
